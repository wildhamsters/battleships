<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SHIPS TRIAL</title>
</head>

<body>
	<table id="playerBoard"></table>
	<button onclick="demo()">DEMO</button>
	<button onclick="clearDemo()">CLEAR</button>
</body>

</html>

<script>
	var table = document.getElementById('playerBoard');
	for (var i = 0; i < 5; i++) {
		var row = document.createElement('tr');
		for (var j = 0; j < 5; j++) {
			var cell = document.createElement('td');
			cell.id = 'cell_' + (i * 5 + j);
			cell.innerHTML = (i * 5 + j);
			cell.className = "water";
			cell.onclick = function (cell) {
				var xmlHttp = new XMLHttpRequest();
				xmlHttp.onreadystatechange = function () {

					if (xmlHttp.readyState == 4 && xmlHttp.status == 200) {
						var response = JSON.parse(xmlHttp.responseText);
						console.log(response);

						switch (response) {
							case FIELD_STATE.MISSED_SHOT:
								document.getElementById(cell.target.id).className = "missed";
								break;
							case FIELD_STATE.WATER:
								document.getElementById(cell.target.id).className = "water";
								break;
							case FIELD_STATE.ACCURATE_SHOT:
								document.getElementById(cell.target.id).className = "accurate";
								break;
							case FIELD_STATE.INTACT_SHIP:
								document.getElementById(cell.target.id).className = "intact";
								break;
						}
					} else if (xmlHttp.readyState == 4 && xmlHttp.status == 400) {
						alert("Bad request");
					}
				};
				xmlHttp.open("GET", 'http://localhost:8080/shoot/' + this.id.replace("cell_", ""), true);
				xmlHttp.send(null);
			}
			row.append(cell);
		}
		table.append(row);
	}

	var FIELD_STATE = {
		WATER: "WATER",
		MISSED_SHOT: "MISSED_SHOT",
		ACCURATE_SHOT: "ACCURATE_SHOT",
		INTACT_SHIP: "INTACT_SHIP"
	};

	function clearDemo() {
		for (var i = 0; i < 25; i++) {
			document.getElementById('cell_' + i).className = "water";
		}
	}

	function demo() {
		var arr = random(0, 25, 5);
		console.log(arr);
		for (var i = 0; i < 5; i++) {
			document.getElementById('cell_' + arr[i]).click();
		}
	}

	function random(min, max, numOfElements) {
		var arr = shuffle(Array.from(Array(max).keys()));
		return arr.slice(0, numOfElements);
	}


	function shuffle(array) {
		var i = array.length,
			j = 0,
			temp;

		while (i--) {
			j = Math.floor(Math.random() * (i + 1));
			temp = array[i];
			array[i] = array[j];
			array[j] = temp;
		}
		return array;
	}
</script>

<style>
	table,
	th,
	td {
		border: 1px solid black;
		border-collapse: collapse;
	}

	table {
		width: 50%;
		height: 50%;
	}

	td {
		text-align: center;
	}

	.water:hover {
		background-color: lightgray;
	}

	.water {
		background-color: aqua;
	}

	.missed {
		background-color: dimgray;
	}

	.accurate {
		background-color: indianred;
	}

	.intact {
		background-color: salmon;
	}
</style>